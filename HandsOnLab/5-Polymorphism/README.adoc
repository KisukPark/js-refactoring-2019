= ìœ í˜•ì— ë”°ë¼ ê³„ì‚°í•˜ëŠ” ë¡œì§ì„ ì¬êµ¬ì„±í•´ë³´ìğŸ˜€

=== ê°œìš”
* ê³„ì‚° ë¡œì§ì„ ì¶”ê°€, ë³€ê²½í•˜ê¸° ìœ„í•´ì„œ amountForì— switch-case ì•ˆì— ë¡œì§ì´ ê³„ì† ì¶”ê°€í•˜ê±°ë‚˜ ìˆ˜ì •í•´ì•¼ í•¨
* êµ¬ì¡°ì ìœ¼ë¡œ ê³„ì‚°í•˜ëŠ” ë¡œì§ì—ë§Œ ë” ì§‘ì¤‘í•  ìˆ˜ ì—†ì„ê¹Œ?
* ê´€ë ¨ ë¦¬íŒ©í† ë§ ê¸°ë²• => https://refactoring.com/catalog/replaceConditionalWithPolymorphism.html[Replace Conditional with Polymorphism]
* ë‹¨ê³„ë³„ë¡œ ì½”ë“œê°€ ìˆ˜ì •ë  ë•Œë§ˆë‹¤ í…ŒìŠ¤íŠ¸ ë™ì‘ì€ í•„ìˆ˜ 

=== Creating a Performance Calculator

===== PerformanceCalculator í´ë˜ìŠ¤ ìƒì„± 
* PerformanceCalculator í´ë˜ìŠ¤ ìƒì„±

image:./images/1.png[]

[source, js]
----
class PerformanceCalculator {
    constructor(aPerformance) {
        this.performance = aPerformance;
    }
}


function enrichPerformance(aPerformance) {
    let calculator = new PerformanceCalculator(aPerformance);

    // ...
----

===== PerformanceCalculator í´ë˜ìŠ¤ ìƒì„±ìë¡œ play ì „ë‹¬
* ì½”ë“œ ì¶”ê°€ 

[source, js]
----
class PerformanceCalculator {
    constructor(aPerformance, aPlay) {
        this.performance = aPerformance;
        this.play = aPlay;
    }
}

function enrichPerformance(aPerformance) {
    let calculator = new PerformanceCalculator(aPerformance, playFor(result));
    
    // ...
----

* í…ŒìŠ¤íŠ¸ ì‹¤í–‰

image:./images/2.png[]

* ì½”ë“œ ì¶”ê°€ 

[source, js]
----
function enrichPerformance(aPerformance) {
    let calculator = new PerformanceCalculator(aPerformance, playFor(aPerformance));
    const result = Object.assign({}, aPerformance);
    result.play = calculator.play;

    // ...
----

image:./images/3.png[]

image:./images/4.png[]

* í…ŒìŠ¤íŠ¸ ì‹¤í–‰

=== Moving Functions into the Calculator

===== ammountFor í•¨ìˆ˜ë¥¼ PerformanceCalculator í´ë˜ìŠ¤ ë‚´ë¶€ë¡œ ì˜®ê¹€
* amountFor í•¨ìˆ˜ë¥¼ PerformanceCalculator í´ë˜ìŠ¤ë¡œ ë³µì‚¬

image:./images/5.png[]

* PerformanceCalculator í´ë˜ìŠ¤ì—ì„œ `amount` getterë¡œ ë³€ê²½

[source, js]
----
class PerformanceCalculator {
    // ...

    get amount() {
        let result = 0;

        switch (this.play.type) {
            case "tragedy":
                result = 40000;

                if (this.performance.audience > 30) {
                    result += 1000 * (this.performance.audience - 30);
                }

                break;
            case "comedy":
                result = 30000;

                if (this.performance.audience > 20) {
                    result += 10000 + 500 * (this.performance.audience - 20);
                }

                result += 300 * this.performance.audience;
                break;
            default:
                throw new Error(`unknown type: ${play.type}`);
        }

        return result;
    }
}
----

image:./images/6.png[]

* í…ŒìŠ¤íŠ¸ ì‹¤í–‰

image:./images/7.png[]

* ì½”ë“œ ì¶”ê°€ 

[source, js]
----
result.amount = calculator.amount;
----

image:./images/8.png[]

* í…ŒìŠ¤íŠ¸ ì‹¤í–‰
* amountFor í•¨ìˆ˜ ì œê±° 

===== PerformanceCalculator í´ë˜ìŠ¤ ë‚´ë¶€ë¡œ volumeCreditsFor í•¨ìˆ˜ ì´ë™
* volumeCreditsForë¥¼ PerformanceCalculator í´ë˜ìŠ¤ë¡œ ë³µì‚¬

image:./images/9.png[]

* PerformanceCalculator í´ë˜ìŠ¤ì—ì„œ volumeCredits getterë¡œ ë³€ê²½

[source, js]
----
class PerformanceCalculator {
    // ...

    get volumeCredits() {
        let result = 0;
        result += Math.max(this.performance.audience - 30, 0);
        // add extra credit for every ten comedy attendees
        if ("comedy" === this.play.type) result += Math.floor(this.performance.audience / 5);
        return result;
    }
}
----

image:./images/10.png[]

* í…ŒìŠ¤íŠ¸ ì‹¤í–‰ 

image:./images/11.png[]

* ì½”ë“œ ì¶”ê°€

[source, js]
----
result.volumeCredits = calculator.volumeCredits;
----

image:./images/12.png[]

* volumeCreditsFor í•¨ìˆ˜ ì œê±° 

=== Making the Performance Calculator Polymorphic

===== createPerformanceCalculator í•¨ìˆ˜ ì¶”ì¶œ

* `createPerformanceCalculator` global scopeë¡œ í•¨ìˆ˜ ì¶”ì¶œ  

image:./images/13.png[]

* ë³€ìˆ˜ëª… ë³€ê²½ 

image:./images/14.png[]

===== TragedyCalculator í´ë˜ìŠ¤ ìƒì„±
* createPerformanceCalculator í•¨ìˆ˜ì—ì„œ Play-typeì— ë”°ë¥¸ switch-case ì‘ì„±

[source, js]
----
function createPerformanceCalculator(aPerformance, aPlay) {
    switch (aPlay.type) {
        case "tragedy": return new TragedyCalculator(aPerformance, aPlay);
    }

    return new PerformanceCalculator(aPerformance, aPlay);	
}
----

* TragedyCalculator í´ë˜ìŠ¤ ìƒì„± 

image:./images/15.png[]

* PerformanceCalculator ë¥¼ ìƒì†ë°›ê³  PerformanceCalculatorì— ìˆëŠ” amount ë¡œì§ ì¤‘, `tragedy` ì— í•´ë‹¹í•˜ëŠ” ë¡œì§ ì²˜ë¦¬

[source, js]
----
class TragedyCalculator extends PerformanceCalculator {
    get amount() {
        let result = 40000;

        if (this.performance.audience > 30) {
            result += 1000 * (this.performance.audience - 30);
        }

        return result;
    }
}
----

image:./images/16.png[]

* í…ŒìŠ¤íŠ¸ ì‹¤í–‰

===== ComedyCalculator í´ë˜ìŠ¤ ìƒì„±
* createPerformanceCalculator í•¨ìˆ˜ì—ì„œ Play-typeì— ë”°ë¥¸ switch-case ì‘ì„±

[source, js]
----
function createPerformanceCalculator(aPerformance, aPlay) {
    switch (aPlay.type) {
        case "tragedy": return new TragedyCalculator(aPerformance, aPlay);	   
        case "comedy": return new ComedyCalculator(aPerformance, aPlay);
    }	    

    return new PerformanceCalculator(aPerformance, aPlay);
}
----

* PerformanceCalculatorë¥¼ ìƒì†ë°›ê³  PerformanceCalculatorì— ìˆëŠ” amount ë¡œì§ ì¤‘, `comedy` ì— í•´ë‹¹í•˜ëŠ” ë¡œì§ ì²˜ë¦¬

[source, js]
----
class ComedyCalculator extends PerformanceCalculator {
    get amount() {
        let result = 30000;
        if (this.performance.audience > 20) {
            result += 10000 + 500 * (this.performance.audience - 20);
        }

        result += 300 * this.performance.audience;
        return result;
    }
}
----

image:./images/17.png[]

* í…ŒìŠ¤íŠ¸ ì‹¤í–‰

===== volumeCredits ë¡œì§ ì²˜ë¦¬
* PerformanceCalculator, ComedyCalculator ì— ë§ê²Œ volumeCredits ë¡œì§ ë¶„ë¦¬

[source, js]
----
// PerformanceCalculator
get volumeCredits() {
    return Math.max(this.performance.audience - 30, 0);
}


// ComedyCalculator
get volumeCredits() {
    return super.volumeCredits + Math.floor(this.performance.audience / 5);
}
----

* í…ŒìŠ¤íŠ¸ ì‹¤í–‰

===== default ì…‹íŒ…
* ì½”ë“œ ì¶”ê°€ 

[source, js]
----
function createPerformanceCalculator(aPerformance, aPlay) {
    switch (aPlay.type) {
        case "tragedy": return new TragedyCalculator(aPerformance, aPlay);	   
        case "comedy": return new ComedyCalculator(aPerformance, aPlay);
        default: return new PerformanceCalculator(aPerformance, aPlay);
    }	    
}
----

image:./images/18.png[]

* í…ŒìŠ¤íŠ¸ ì‹¤í–‰

=== ë¶ˆí•„ìš”í•œ ë¡œì§ ì œê±° 

===== PerformanceCalculator í´ë˜ìŠ¤ì—ì„œ ë¶ˆí•„ìš”í•œ ë¡œì§ ì œê±° 

image:./images/19.png[]

image:./images/20.png[]
