= ìœ í˜•ì— ë”°ë¼ ê³„ì‚°í•˜ëŠ” ë¡œì§ì„ ì¬êµ¬ì„±í•´ë³´ìğŸ˜€

=== ê°œìš”
* ê³„ì‚° ë¡œì§ì„ ì¶”ê°€, ë³€ê²½í•˜ê¸° ìœ„í•´ì„œ amountForì— switch-case ì•ˆì— ë¡œì§ì´ ê³„ì† ì¶”ê°€í•˜ê±°ë‚˜ ìˆ˜ì •í•´ì•¼ í•¨
* êµ¬ì¡°ì ìœ¼ë¡œ ê³„ì‚°í•˜ëŠ” ë¡œì§ì—ë§Œ ë” ì§‘ì¤‘í•  ìˆ˜ ì—†ì„ê¹Œ?
* ê´€ë ¨ ë¦¬íŒ©í† ë§ ê¸°ë²• => https://refactoring.com/catalog/replaceConditionalWithPolymorphism.html[Replace Conditional with Polymorphism]
* ë‹¨ê³„ë³„ë¡œ ì½”ë“œê°€ ìˆ˜ì •ë  ë•Œë§ˆë‹¤ í…ŒìŠ¤íŠ¸ ë™ì‘ì€ í•„ìˆ˜ 

=== Creating a Performance Calculator

===== PerformanceCalculator í´ë˜ìŠ¤ ìƒì„± 
* enrichPerformance í•¨ìˆ˜ì—ì„œ `const calculator = new PerformanceCalculator(aPerformance);` ì¶”ê°€ 
* Webstormì—ì„œ ì•„ë˜ ê·¸ë¦¼ ê°™ì´ í´ë˜ìŠ¤ ìƒì„±í•  ìˆ˜ ìˆë„ë¡ íˆ´íŒì´ ëœ¨ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŒ
* í´ë¦­ í›„, PerformanceCalculator í´ë˜ìŠ¤ ìƒì„±

image:./images/1.png[]

* https://github.com/yuaming/js-refactoring-2nd/pull/1/commits/1bd893bbc4740a07f1bbec7cb59a6781170e42f5[PerformanceCalculator á„á…³á†¯á„…á…¢á„‰á…³ á„‰á…¢á†¼á„‰á…¥á†¼ ì½”ë“œ]

===== PerformanceCalculator í´ë˜ìŠ¤ì˜ ìƒì„±ì play ì „ë‹¬
* ê´€ë ¨ ë°ì´í„°ë¥¼ í•œ ê³³ìœ¼ë¡œ ëª¨ìœ¼ë©´ ì¼ê´€ì„±ì„ ìœ ì§€í•  ìˆ˜ ìˆìœ¼ë©° ì½”ë“œê°€ ëª…í™•í•´ì§€ê¸° ë•Œë¬¸ì— `playFor(result)` ë¥¼ PerformanceCalculator í´ë˜ìŠ¤ ìƒì„±ìë¡œ ì˜®ê¹€
* `const calculator = new PerformanceCalculator(aPerformance, playFor(result));`
* í…ŒìŠ¤íŠ¸ ì‹¤í–‰

image:./images/2.png[]

* `const calculator = new PerformanceCalculator(aPerformance, playFor(result));` => `const calculator = new PerformanceCalculator(aPerformance, playFor(aPerformance));` ë³€ê²½ 
* `result.play = playFor(result)` => `result.play = calculator.play` ë³€ê²½ 

image:./images/3.png[]

image:./images/4.png[]

* í…ŒìŠ¤íŠ¸ ì‹¤í–‰

* https://github.com/yuaming/js-refactoring-2nd/pull/1/commits/40903305ddaa71d59c81bb04708ee7ba61138fac[play ì „ë‹¬ ì½”ë“œ]

=== Moving Functions into the Calculator

===== ammountFor í•¨ìˆ˜ë¥¼ PerformanceCalculator í´ë˜ìŠ¤ ë‚´ë¶€ë¡œ ì˜®ê¹€
* amountForë¥¼ PerformanceCalculator í´ë˜ìŠ¤ ë‚´ë¶€ë¡œ ë³µì‚¬í•¨

image:./images/5.png[]

* PerformanceCalculator í´ë˜ìŠ¤ì— ë§ê²Œ ì½”ë“œ ìˆ˜ì •í•¨

image:./images/6.png[]

* í…ŒìŠ¤íŠ¸ ì‹¤í–‰

image:./images/7.png[]

* `result.amount = amountFor(result)` ë¥¼ `result.amount = calculator.amount` ë³€ê²½

image:./images/8.png[]

* í…ŒìŠ¤íŠ¸ ì‹¤í–‰

* https://github.com/yuaming/js-refactoring-2nd/pull/1/commits/09299353c051028a631e21071e88fd69f9295a16[PerformanceCalculator í´ë˜ìŠ¤ë¡œ amountFor í•¨ìˆ˜ ì´ë™ ì½”ë“œ]

===== PerformanceCalculator í´ë˜ìŠ¤ ë‚´ë¶€ë¡œ volumeCreditsFor í•¨ìˆ˜ ì´ë™
* amountFor ì´ë™í•œ ë°©ë²•ê³¼ ë™ì¼í•˜ê²Œ ì²˜ë¦¬í•¨ 
* volumeCreditsForë¥¼ PerformanceCalculator í´ë˜ìŠ¤ ë‚´ë¶€ë¡œ ë³µì‚¬í•¨

image:./images/9.png[]

* PerformanceCalculator í´ë˜ìŠ¤ì— ë§ê²Œ ì½”ë“œë¥¼ ìˆ˜ì •í•¨

image:./images/10.png[]

* í…ŒìŠ¤íŠ¸ ì‹¤í–‰ 

image:./images/11.png[]

* `result.volumeCredits = volumeCreditsFor(result)` ì—ì„œ `result.volumeCredits = calculator.volumeCredits;` ë³€ê²½

image:./images/12.png[]

* í…ŒìŠ¤íŠ¸ ì‹¤í–‰

* https://github.com/yuaming/js-refactoring-2nd/pull/1/commits/5cd0a58a3e0d338d355517dd602e6218a457dfcd[PerformanceCalculator í´ë˜ìŠ¤ë¡œ volumeCreditsFor í•¨ìˆ˜ ì´ë™ ì½”ë“œ]

=== Making the Performance Calculator Polymorphic

===== createPerformanceCalculator í•¨ìˆ˜ ì¶”ì¶œ
* `const calculator = new PerformanceCalculator(aPerformance, playFor(aPerformance));` ë¥¼ `const calculator = createPerformanceCalculator(aPerformance, playFor(aPerformance));` global ìŠ¤ì½”í”„ë¡œ í•¨ìˆ˜ ì¶”ì¶œ 

image:./images/13.png[]

* ë³€ìˆ˜ëª… ë³€ê²½ 

image:./images/14.png[]

* https://github.com/yuaming/js-refactoring-2nd/pull/1/commits/ef0fa2a67fa9f2040b52aab006f263a68cfdeddd[createPerformanceCalculator í•¨ìˆ˜ ì¶”ì¶œ ì½”ë“œ]

===== TragedyCalculator í´ë˜ìŠ¤ ìƒì„±
* `createPerformanceCalculator` í•¨ìˆ˜ì—ì„œ ì•„ë˜ ê·¸ë¦¼ê³¼ ê°™ì´ switch-case ì‘ì„±

[source, js]
----
function createPerformanceCalculator(aPerformance, aPlay) {
    switch (aPlay.type) {
        case "tragedy": return new TragedyCalculator(aPerformance, aPlay);
    }

    return new PerformanceCalculator(aPerformance, aPlay);	
}
----

* `TragedyCalculator` ìƒì„± 

image:./images/15.png[]

* `PerformanceCalculator` ë¥¼ ìƒì†ë°›ê³  PerformanceCalculatorì— ìˆëŠ” amount ë¡œì§ ì¤‘, `tragedy` ì— í•´ë‹¹í•˜ëŠ” ë¡œì§ì„ ì˜®ê¸°ê³  TragedyCalculator í´ë˜ìŠ¤ì— ë§ê²Œ ìˆ˜ì •í•¨

image:./images/16.png[]

* í…ŒìŠ¤íŠ¸ ì‹¤í–‰
* https://github.com/yuaming/js-refactoring-2nd/pull/1/commits/589542c09170450573ea114c3331c1c09411dd87[TragedyCalculator í´ë˜ìŠ¤ ìƒì„± ì½”ë“œ]

===== ComedyCalculator í´ë˜ìŠ¤ ìƒì„±
* `createPerformanceCalculator` í•¨ìˆ˜ì—ì„œ ì•„ë˜ ê·¸ë¦¼ê³¼ ê°™ì´ switch-case ì‘ì„±

[source, js]
----
unction createPerformanceCalculator(aPerformance, aPlay) {
    switch (aPlay.type) {
        case "tragedy": return new TragedyCalculator(aPerformance, aPlay);	   
        case "comedy": return new ComedyCalculator(aPerformance, aPlay);
    }	    

    return new PerformanceCalculator(aPerformance, aPlay);
}
----

* `PerformanceCalculator` ë¥¼ ìƒì†ë°›ê³  PerformanceCalculatorì— ìˆëŠ” amount ë¡œì§ ì¤‘, `comedy` ì— í•´ë‹¹í•˜ëŠ” ë¡œì§ì„ ì˜®ê¸°ê³  ComedyCalculator í´ë˜ìŠ¤ì— ë§ê²Œ ìˆ˜ì •í•¨

image:./images/17.png[]

* í…ŒìŠ¤íŠ¸ ì‹¤í–‰
* https://github.com/yuaming/js-refactoring-2nd/pull/1/commits/2a4a1e3f533719b7825c29318dab65086d49045b[ComedyCalculator í´ë˜ìŠ¤ ìƒì„± ì½”ë“œ]

===== ComedyCalculatorì˜ volumeCredits í•¨ìˆ˜ ì´ë™
* `PerformanceCalculator, ComedyCalculator` ì— ë§ê²Œ volumeCredits ë¡œì§ ë¶„ë¦¬

[source, js]
----
// PerformanceCalculator
get volumeCredits() {
    return Math.max(this.performance.audience - 30, 0);
}


// ComedyCalculator
get volumeCredits() {
    return super.volumeCredits + Math.floor(this.performance.audience / 5);
}
----

* í…ŒìŠ¤íŠ¸ ì‹¤í–‰

===== default ì…‹íŒ…
* `return new PerformanceCalculator(aPerformance, aPlay);` ì—ì„œ `default: return new PerformanceCalculator(aPerformance, aPlay);` ë¡œ ìˆ˜ì •

image:./images/18.png[]

=== ë¶ˆí•„ìš”í•œ ë¡œì§ ì œê±° 

===== PerformanceCalculator í´ë˜ìŠ¤ì—ì„œ ë¶ˆí•„ìš”í•œ ë¡œì§ ì œê±° 

image:./images/19.png[]

image:./images/20.png[]

* https://github.com/yuaming/js-refactoring-2nd/pull/1/commits/7741bac22ee6ec566ca3586bbae9e7ffa2754ac8[ë¶ˆí•„ìš”í•œ ë¡œì§ ì œê±° ì½”ë“œ]
* https://github.com/yuaming/js-refactoring-2nd/pull/1/files[ìµœì¢… ì½”ë“œ]